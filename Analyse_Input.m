clear;clc; close all

\%F1
\%pos = [[657,152,667,100,131,321];[657,152,667,100,131,321];[657,152,667,100,131,321];[657,152,667,100,131,321];[657,152,667,100,131,321];[657,152,667,100,131,321];[657,152,667,100,131,321];[657,152,667,100,131,321];[656,152,667,100,131,321];[656,152,667,100,131,321];[656,152,667,100,131,321];[656,152,667,100,131,321];[656,152,667,100,131,321];[656,152,667,115,131,321];[646,161,678,161,131,321];[624,177,698,193,131,321];[605,192,715,226,131,321];[589,205,732,261,131,321];[573,219,725,296,131,321];[557,231,716,332,131,321];[540,244,708,368,131,321];[524,257,699,388,131,321];[508,270,682,360,131,321];[492,283,666,334,131,321];[477,295,650,312,131,321];[461,308,635,294,131,321];[445,320,620,275,131,321];[429,333,604,256,131,321];[414,344,590,239,131,321];[398,357,576,221,131,321];[383,369,561,203,131,321];[368,381,547,186,131,321];[353,389,532,168,130,321];[342,382,518,150,130,321];[330,375,504,133,130,321];[319,370,490,116,130,321];[308,363,476,100,130,321];[297,357,468,108,130,321];[286,352,460,118,130,321];[275,346,452,127,130,321];[265,340,444,135,130,321];[254,335,436,143,130,321];[244,329,428,151,130,321];[233,324,420,159,131,321];[223,318,412,167,131,321];[213,313,404,175,131,321];[202,308,396,183,131,321];[193,302,388,191,131,321];[183,296,381,198,131,321];[173,291,374,206,131,321];[163,286,366,214,131,321];[153,281,358,221,131,321];[143,276,351,229,131,321];[134,270,344,236,131,321];[132,266,336,243,131,321];[138,261,330,250,131,321];[143,256,322,258,131,321];[149,253,316,265,131,321];[154,247,308,272,131,321];[159,243,302,278,130,321];[164,240,294,285,130,321];[169,235,288,292,130,321];[175,231,282,299,130,321];[179,227,274,305,130,321];[184,223,268,312,130,321];[188,219,262,318,130,321];[193,215,255,325,130,321];[198,211,249,331,130,321];[202,208,242,338,130,321];[206,205,236,344,130,321];[211,201,230,350,130,321];[215,197,224,356,130,321];[220,194,218,362,130,321];[224,190,212,368,130,321];[228,187,206,374,131,321];[232,184,200,379,131,321];[236,181,194,385,131,321];[240,178,188,390,131,321];[243,174,184,387,131,321];[246,171,179,384,131,321];[250,169,176,381,131,321];[254,166,171,378,131,321];[258,163,167,376,131,321];[261,160,163,373,131,321];[264,157,160,370,131,321];[267,155,156,367,131,321];[270,152,152,365,131,321];[273,149,148,362,131,321];[276,147,145,360,131,321];[279,145,141,358,131,321];[282,143,138,355,131,321];[285,141,135,353,131,321];[288,138,132,350,130,321];[289,136,128,348,130,321];[292,134,130,346,130,321];[295,133,131,345,130,321];[298,130,133,342,130,321];[299,128,134,341,130,321];[301,127,136,339,130,321];[303,125,138,337,131,321];[305,123,139,336,130,321];[308,121,140,334,131,321];[309,120,142,332,130,321];[312,119,144,331,131,321];[312,117,144,330,131,321];[315,116,146,328,131,321];[316,115,146,327,131,321];[318,113,148,326,131,321];[319,112,148,325,131,321];[320,111,149,323,131,321];[322,110,150,322,131,321];[323,109,150,321,131,321];[324,108,152,320,131,321];[325,107,152,320,131,321];[326,106,152,319,131,321];[326,106,152,318,131,321];[327,105,152,317,131,321];[329,104,153,317,131,321];[329,104,153,317,131,321];[329,103,154,316,131,321];[330,103,154,316,131,321];[330,102,154,315,131,321];[330,101,154,315,130,321];[331,101,154,315,130,321];[331,101,154,315,130,321];[331,101,154,315,130,321];[332,101,154,315,130,321];[332,101,154,315,130,321];[332,100,154,315,131,321];[332,100,154,315,131,321];[332,100,154,315,131,321];[333,100,154,315,131,321]];
\%F2n
\%pos = [[681,180,160,187,213,334];[681,180,188,256,213,334];[681,180,231,324,210,353];[681,180,288,334,197,353];[681,180,341,346,186,286];[681,180,390,357,175,221];[682,180,436,369,164,160];[682,180,482,382,153,101];[681,180,529,389,149,143];[682,180,577,381,149,184];[681,180,625,375,146,217];[681,180,677,369,145,254];[681,180,726,364,142,284];[681,180,706,348,139,317];[681,180,664,326,137,348];[681,180,628,306,135,379];[681,180,597,288,134,374];[681,180,569,271,135,351];[681,180,542,253,135,331];[681,180,517,235,135,313];[681,180,493,218,135,295];[681,180,468,201,135,278];[681,180,444,184,135,261];[681,180,420,167,135,243];[681,180,396,150,135,227];[681,180,372,133,135,210];[681,180,348,117,135,193];[681,180,324,100,135,176];[681,180,302,108,135,160];[681,180,278,118,135,143];[681,180,255,127,135,126];[681,180,232,137,135,111];[682,180,209,146,135,100];[681,180,186,155,136,112];[681,180,163,164,136,121];[681,180,140,173,136,130];[681,180,138,184,136,139];[681,180,155,198,136,148];[681,180,169,211,136,157];[681,180,181,223,136,166];[681,180,194,235,136,175];[681,180,206,248,135,183];[681,180,218,260,135,192];[681,180,230,272,135,200];[681,180,243,284,135,208];[681,180,255,296,135,217];[681,180,267,308,135,225];[681,180,280,320,135,233];[681,180,291,332,135,241];[681,180,302,344,135,249];[681,180,314,356,135,257];[681,180,326,368,134,264];[681,180,338,379,134,272];[681,180,349,390,134,279];[681,180,360,383,134,287];[681,180,372,377,133,294];[681,180,382,370,133,301];[681,180,394,364,133,308];[681,180,404,358,133,316];[681,180,414,352,133,323];[681,180,426,345,133,329];[682,180,436,339,133,336];[682,180,446,333,133,343];[682,180,456,327,132,349];[681,180,466,321,132,356];[681,180,476,315,132,362];[681,180,486,309,132,368];[681,180,496,303,132,374];[681,180,506,297,131,381];[681,180,516,291,131,386];[681,180,526,286,131,390];[681,180,536,280,131,387];[681,180,545,274,131,383];[681,180,554,269,131,381];[681,180,564,263,131,377];[681,180,572,258,132,374];[681,180,582,253,132,371];[681,180,592,248,132,369];[681,180,600,242,132,366];[681,180,610,236,132,363];[681,180,618,231,132,360];[681,180,628,226,132,358];[681,180,636,221,132,356];[681,180,644,216,132,353];[681,180,653,211,132,351];[681,180,662,206,132,349];[681,180,670,201,132,347];[681,180,678,196,132,345];[681,179,687,192,132,343];[681,177,696,190,132,341];[681,176,704,187,132,339];[681,174,712,185,132,337];[681,171,720,182,132,336];[681,169,728,180,132,334];[681,168,731,177,131,333];[681,167,726,174,132,331];[681,165,722,171,131,330];[681,163,718,169,131,329];[681,162,714,166,131,328];[681,161,709,163,131,327];[680,160,705,160,130,326];[680,159,700,158,130,325];[680,158,697,155,130,324];[680,157,693,153,130,324];[679,156,691,150,130,323];[676,156,690,147,130,323];[675,155,689,145,130,322];[673,155,688,142,131,322];[671,154,686,139,131,321];[670,154,685,137,131,321];[668,154,684,134,131,321];[667,154,683,132,131,321];[666,153,682,130,131,321];[665,153,681,128,131,321];[664,153,680,126,131,321];[663,153,679,124,131,321];[662,153,678,122,131,321];[661,153,677,120,131,321];[660,153,676,118,131,321];[659,153,675,117,131,321];[659,153,674,115,131,321];[658,153,674,114,131,321];[657,153,673,112,131,321];[657,153,672,111,131,321];[657,153,672,110,131,321];[657,152,670,109,131,321]];
\%F3
\%pos = [[287,287,296,99,136,142];[287,287,296,104,136,142];[287,287,292,152,136,143];[287,287,288,208,136,142];[287,287,280,266,137,143];[308,311,251,302,137,144];[330,336,224,330,136,143];[353,362,192,365,136,142];[371,382,166,388,136,142];[386,381,135,359,136,143];[397,365,144,330,136,142];[408,352,167,305,136,142];[419,339,192,277,136,143];[431,327,216,250,136,142];[442,315,238,225,136,143];[453,301,258,202,136,142];[465,288,278,180,136,142];[478,275,298,157,136,143];[489,262,316,136,136,142];[499,250,334,116,136,143];[510,237,352,99,136,142];[523,223,376,117,136,142];[534,211,396,132,136,143];[547,197,418,145,136,142];[558,184,437,156,136,142];[570,170,460,170,136,142];[581,159,480,182,136,143];[593,144,504,195,136,142];[607,130,526,209,136,143];[618,116,548,222,136,142];[631,102,572,236,136,143];[642,100,594,249,136,142];[650,109,616,262,136,143];[658,115,640,276,136,142];[665,121,664,289,136,143];[673,128,686,303,136,142];[681,134,709,316,136,143];[689,140,732,329,136,142];[697,146,721,344,136,143];[705,152,705,359,136,142];[712,158,692,375,136,143];[720,164,679,390,136,142];[728,170,666,384,136,143];[733,175,652,374,136,142];[729,180,639,366,136,143];[725,183,626,357,136,142];[721,187,613,349,136,143];[718,191,600,340,136,142];[714,194,588,332,136,143];[710,198,576,324,136,142];[707,201,562,315,136,143];[704,205,550,307,136,142];[701,208,538,299,136,143];[697,211,526,292,136,142];[695,214,514,283,136,143];[691,218,502,275,136,142];[688,221,490,268,136,143];[685,224,478,260,136,142];[682,227,467,253,136,143];[679,230,456,245,136,142];[677,233,444,238,136,143];[674,235,432,230,136,142];[671,239,422,223,136,143];[669,241,410,215,136,142];[666,244,399,208,136,143];[663,246,388,201,136,142];[661,249,377,194,136,143];[659,251,366,187,136,142];[656,253,356,181,136,143];[654,255,345,174,136,142];[652,258,335,167,136,143];[650,259,324,160,136,142];[648,262,314,154,136,143];[646,264,304,147,136,142];[644,266,294,140,136,143];[642,267,284,134,136,142];[641,269,274,128,136,143];[639,271,264,121,136,142];[637,273,254,115,136,143];[636,274,244,109,136,142];[634,276,234,103,136,143];[632,277,225,99,136,142];[631,279,218,102,136,143];[630,280,210,105,136,142];[629,281,204,108,136,143];[627,282,196,111,136,142];[626,283,189,113,136,143];[625,285,182,116,136,142];[624,286,176,119,136,143];[623,287,168,122,136,142];[622,287,162,124,136,143];[621,288,154,127,136,142];[620,289,148,129,136,143];[620,289,142,131,135,143];[619,290,139,130,134,146];[619,290,136,129,132,147];[619,290,134,128,131,149];[618,291,132,128,130,151];[618,291,130,128,130,153];[618,291,130,127,130,153]];
\%F4
\%pos = [[285,354,130,262,597,121];[285,354,130,262,597,122];[285,354,130,262,597,121];[285,354,130,262,513,187];[285,354,130,262,404,272];[285,354,130,262,299,353];[213,348,130,262,291,381];[132,346,130,262,288,304];[187,346,130,262,282,239];[246,343,130,262,275,177];[301,342,130,262,265,117];[354,343,130,262,260,130];[405,344,130,262,256,174];[452,342,130,262,249,215];[498,342,130,262,243,246];[542,342,130,262,234,280];[587,341,130,262,223,315];[633,342,130,262,213,345];[679,342,130,262,202,378];[725,341,130,262,196,376];[708,341,130,262,193,353];[672,341,130,262,189,332];[639,341,130,262,184,315];[610,341,130,262,180,298];[583,341,130,262,176,281];[558,341,130,262,172,264];[533,341,130,262,167,246];[508,341,130,262,163,230];[483,341,130,262,159,214];[459,341,130,262,155,197];[434,341,130,262,151,181];[409,341,130,262,147,165];[385,341,130,262,142,148];[361,341,130,262,139,133];[337,341,130,262,134,116];[313,341,130,262,131,101];[289,341,130,262,130,107];[265,341,130,262,130,116];[243,341,130,262,130,125];[219,341,130,262,131,134];[196,341,130,262,130,142];[173,341,130,262,131,150];[149,341,130,262,131,158];[129,341,130,262,131,166];[147,341,130,262,131,175];[162,341,130,262,131,182];[176,341,130,262,132,190];[189,341,130,262,132,198];[202,341,130,262,132,205];[215,342,130,262,132,213];[227,341,130,262,132,220];[239,342,130,262,132,228];[252,341,130,262,132,235];[265,341,130,262,133,242];[277,341,129,262,133,249];[288,341,130,266,135,251];[301,341,131,269,136,253];[313,341,132,273,138,255];[325,340,132,276,139,256];[337,340,134,279,140,258];[348,340,134,282,142,259];[359,340,136,285,143,261];[371,340,136,288,144,262];[382,340,137,290,146,263];[393,340,138,293,147,264];[404,340,138,296,148,266];[415,340,139,298,149,267];[426,339,140,301,150,268];[437,339,140,303,150,269];[448,339,142,305,151,270];[458,339,141,307,152,271];[469,338,142,309,153,272];[479,338,142,311,153,272];[490,338,143,313,153,273];[500,338,144,314,154,274];[509,338,144,316,155,274];[519,337,144,318,155,274];[529,337,144,319,155,275];[539,337,146,320,155,275];[549,337,146,321,156,275];[559,336,146,322,156,275];[568,336,146,323,156,275];[577,336,146,325,156,275];[587,336,146,325,156,275];[596,336,146,326,156,275];[605,336,146,327,156,275];[614,336,146,327,156,275];[623,336,146,328,156,275];[633,335,146,329,156,275];[641,335,146,329,156,275];[650,335,146,329,156,275];[659,335,146,329,156,275];[667,335,146,330,156,275];[675,335,146,330,156,275];[684,335,146,330,156,275];[692,335,146,329,156,275];[700,335,146,329,156,275];[709,335,146,329,156,275];[716,335,146,329,156,275];[724,335,146,329,156,275];[731,335,146,329,156,275];[733,335,146,329,156,275];[729,335,146,329,156,275];[725,335,146,329,156,275];[720,335,146,329,156,275];[716,335,146,329,156,275];[712,335,146,329,156,275];[708,335,146,329,156,275];[704,335,146,329,156,275];[701,336,146,329,156,275];[697,336,146,329,156,275]];
\%F5n
\%pos = [[321,102,444,122,498,353];[321,102,456,177,498,354];[321,102,478,271,498,354];[321,102,488,344,504,364];[321,102,468,358,535,364];[321,102,450,374,564,304];[321,102,433,390,590,250];[321,102,408,379,613,204];[321,102,386,369,634,159];[321,102,363,361,656,116];[321,102,341,354,671,110];[321,102,318,346,677,138];[321,102,296,338,685,165];[321,102,274,330,693,189];[321,102,252,323,701,210];[321,102,230,316,710,231];[321,102,208,308,719,252];[321,102,186,301,727,273];[321,102,164,294,734,292];[321,102,143,287,731,308];[321,102,130,278,727,325];[321,102,148,262,723,342];[321,102,162,247,720,359];[321,102,172,232,716,376];[321,102,182,218,713,392];[321,102,192,204,707,383];[321,102,202,190,702,373];[321,102,213,176,697,364];[321,102,222,162,691,354];[321,102,232,148,686,344];[321,102,242,134,681,335];[321,102,252,121,676,326];[321,102,262,107,672,318];[321,102,272,100,667,308];[321,102,286,109,662,300];[321,102,298,115,658,291];[321,102,312,121,653,283];[321,102,325,128,648,274];[321,102,338,134,644,266];[321,102,350,140,639,258];[321,102,364,146,635,250];[321,102,376,152,631,241];[321,102,388,158,626,234];[321,102,401,164,622,226];[321,102,414,170,618,218];[321,102,426,176,614,210];[321,102,438,181,609,203];[321,102,450,187,606,195];[321,102,462,193,601,188];[321,102,474,199,598,180];[321,102,486,205,594,173];[321,102,498,211,590,166];[321,102,510,216,586,159];[321,102,522,222,583,152];[321,102,533,227,579,145];[321,102,544,233,575,139];[321,102,556,239,572,132];[321,102,568,244,568,125];[321,102,579,250,564,119];[321,102,590,255,561,112];[321,102,601,261,557,106];[321,102,612,266,554,100];[321,102,624,271,551,98];[321,102,634,276,549,101];[321,102,644,282,547,105];[321,102,655,287,545,108];[321,102,666,292,543,111];[321,102,676,298,541,114];[321,102,687,303,539,117];[321,102,698,308,538,120];[321,102,708,313,536,123];[321,102,718,318,534,126];[321,102,728,323,532,128];[321,102,734,329,530,131];[321,102,728,337,529,133];[321,102,724,345,527,136];[321,102,718,353,526,138];[321,102,714,361,525,141];[321,102,709,369,523,143];[321,102,704,376,522,145];[321,102,699,384,520,147];[321,102,695,391,519,149];[321,102,689,390,518,150];[321,102,682,386,517,152];[321,102,676,382,516,154];[321,102,670,378,514,156];[321,102,664,374,513,157];[321,102,658,371,512,159];[321,102,651,367,511,160];[321,102,646,363,510,162];[321,102,640,360,509,163];[321,102,634,357,508,164];[321,102,628,353,507,165];[321,102,623,349,507,166];[321,102,618,346,506,167];[321,102,612,343,505,168];[321,102,607,340,505,169];[321,102,602,336,504,169];[321,102,597,333,503,170];[321,102,592,330,503,171];[321,102,588,327,502,171];[321,102,582,324,502,172];[321,102,578,321,502,172];[321,102,574,317,501,172];[321,102,568,314,501,173];[321,102,564,312,501,173];[321,102,560,309,500,173];[321,102,556,306,500,173];[321,102,552,303,500,173];[321,102,548,301,500,173];[321,102,544,298,500,173];[321,102,540,295,500,173];[321,102,536,293,500,173];[321,102,532,290,500,173];[321,102,528,288,500,173];[321,102,524,286,500,173];[321,102,522,283,500,173];[321,102,518,281,500,173];[321,102,514,279,500,173];[321,102,512,276,500,173];[321,102,508,274,500,173];[321,102,506,272,500,173];[321,102,502,270,500,173];[321,102,500,268,500,173];[321,102,496,266,500,173];[321,102,494,264,500,173];[321,102,491,262,500,173];[321,102,488,261,500,173];[321,102,486,259,500,173];[321,102,483,257,500,173];[321,102,480,255,500,173];[321,102,478,254,500,173];[321,102,476,252,500,173];[321,102,474,251,500,173];[321,102,472,250,500,173];[321,102,470,248,500,173];[321,102,468,246,500,173];[321,102,466,245,500,173];[321,102,464,244,500,173];[321,102,462,242,500,173];[321,102,461,241,500,173];[321,102,460,240,500,173];[321,102,458,239,500,173];[321,102,456,238,500,173];[321,102,455,237,500,173];[321,102,454,236,500,173];[321,102,452,235,500,173];[321,102,452,234,500,173];[321,102,450,233,500,173];[321,102,450,232,500,173];[321,102,448,232,500,173];[321,102,448,231,500,173];[321,102,446,230,500,173];[321,102,446,230,500,173];[321,102,446,229,500,173];[321,102,445,229,500,173];[321,102,444,228,500,173];[321,102,444,228,500,173];[321,102,444,228,500,173];[321,102,444,228,500,173]];
\%F6
\%pos = [[321,102,442,228,500,173];[321,102,442,228,500,173];[321,102,442,228,463,156];[321,102,442,228,419,137];[321,102,442,228,379,119];[321,102,442,228,339,101];[292,107,442,228,324,112];[263,112,442,228,312,128];[237,117,442,228,297,143];[214,121,442,228,280,157];[192,125,442,228,262,171];[169,130,442,228,245,185];[147,134,442,228,229,198];[130,137,442,228,214,210];[147,137,442,228,198,223];[162,140,442,228,182,236];[174,141,442,228,166,249];[187,142,442,228,148,263];[199,143,442,228,133,275];[211,145,442,228,135,288];[223,146,442,228,145,301];[235,148,442,228,153,312];[247,149,442,228,162,325];[259,151,442,228,171,336];[271,152,442,228,180,348];[282,153,442,228,188,359];[293,155,442,228,197,371];[304,157,442,228,206,383];[317,157,442,228,215,389];[328,159,442,228,224,382];[338,160,442,228,233,375];[349,162,442,228,243,368];[360,163,442,228,251,362];[371,165,442,228,261,355];[382,166,442,228,269,349];[392,167,442,228,278,342];[402,169,442,228,286,336];[413,170,442,228,295,330];[423,171,442,228,303,324];[434,173,442,228,312,317];[443,174,442,228,320,311];[453,175,442,228,328,305];[463,176,442,228,335,299];[473,178,442,228,343,294];[483,179,442,228,351,288];[491,180,442,228,359,282];[501,181,442,228,366,276];[511,183,442,228,374,271];[520,184,442,228,381,265];[530,185,442,228,389,260];[538,186,442,228,396,254];[547,187,442,228,403,249];[556,188,442,228,411,243];[566,189,442,228,418,238];[575,190,442,228,424,233];[583,192,444,228,428,228];[591,193,450,228,429,224];[600,194,454,228,430,219];[609,195,458,227,430,215];[617,196,462,227,431,211];[625,197,466,227,432,207];[634,198,470,227,432,203];[643,199,474,227,432,199];[651,200,478,227,433,195];[659,201,482,227,434,191];[666,202,485,227,434,188];[674,203,488,227,435,184];[682,204,492,227,435,181];[690,205,496,227,436,177];[698,206,498,227,436,174];[704,207,500,227,437,171];[711,208,504,226,437,168];[719,209,506,226,438,165];[726,210,509,226,438,162];[732,211,512,226,438,159];[732,212,514,226,439,156];[728,213,516,226,439,154];[724,213,518,226,439,152];[720,213,520,226,439,149];[716,214,522,226,440,147];[713,215,524,226,440,144];[709,215,526,226,441,142];[706,217,528,226,441,140];[703,217,530,226,441,138];[699,217,532,226,441,136];[696,218,534,226,442,134];[693,218,534,226,442,133];[690,219,536,226,443,131];[687,219,538,227,443,129];[684,220,540,226,443,128];[682,220,540,227,444,126];[679,220,542,227,444,125];[677,221,543,227,444,124];[675,221,544,227,444,123];[672,221,544,227,445,122];[670,221,546,227,445,121];[668,221,546,227,445,120];[666,222,546,227,445,119];[664,222,546,227,445,118];[661,222,547,227,445,118];[661,223,547,227,446,117];[659,222,547,227,446,117];[657,222,547,227,446,117];[655,223,547,227,446,116]];

pos = %s;
ball_diam = %d;


\%solve outliers
pos(:,1) = pos(:,1).*~(isoutlier(pos(:,1),'movmedian',5)&isoutlier(pos(:,2),'movmedian',5))+(isoutlier(pos(:,1),'movmedian',5)&isoutlier(pos(:,2),'movmedian',5)).*([pos(2:end,1);pos(end,1)]+[pos(end,1);pos(1:end-1,1)])/2;
pos(:,2) = pos(:,2).*~(isoutlier(pos(:,1),'movmedian',5)&isoutlier(pos(:,2),'movmedian',5))+(isoutlier(pos(:,1),'movmedian',5)&isoutlier(pos(:,2),'movmedian',5)).*([pos(2:end,2);pos(end,2)]+[pos(end,2);pos(1:end-1,2)])/2;
pos(:,3) = pos(:,3).*~(isoutlier(pos(:,3),'movmedian',5)&isoutlier(pos(:,4),'movmedian',5))+(isoutlier(pos(:,3),'movmedian',5)&isoutlier(pos(:,4),'movmedian',5)).*([pos(2:end,3);pos(end,3)]+[pos(end,3);pos(1:end-1,3)])/2;
pos(:,4) = pos(:,4).*~(isoutlier(pos(:,3),'movmedian',5)&isoutlier(pos(:,4),'movmedian',5))+(isoutlier(pos(:,3),'movmedian',5)&isoutlier(pos(:,4),'movmedian',5)).*([pos(2:end,4);pos(end,4)]+[pos(end,4);pos(1:end-1,4)])/2;
pos(:,5) = pos(:,5).*~(isoutlier(pos(:,5),'movmedian',5)&isoutlier(pos(:,6),'movmedian',5))+(isoutlier(pos(:,5),'movmedian',5)&isoutlier(pos(:,6),'movmedian',5)).*([pos(2:end,5);pos(end,5)]+[pos(end,5);pos(1:end-1,5)])/2;
pos(:,6) = pos(:,6).*~(isoutlier(pos(:,5),'movmedian',5)&isoutlier(pos(:,6),'movmedian',5))+(isoutlier(pos(:,5),'movmedian',5)&isoutlier(pos(:,6),'movmedian',5)).*([pos(2:end,6);pos(end,6)]+[pos(end,6);pos(1:end-1,6)])/2;


\%find border
x_min = min(min(pos(:,[1 3 5])));
x_max = max(max(pos(:,[1 3 5])));
y_min = min(min(pos(:,[2 4 6])));
y_max = max(max(pos(:,[2 4 6])));


\%plot data
ScoreSheet = figure(1);
hold on
plot(pos(:,1),pos(:,2),'color',[%f %f %f],'lineStyle','%s','Marker','.');
plot(pos(:,3),pos(:,4),'color',[%f %f %f],'lineStyle','%s','Marker','.');
plot(pos(:,5),pos(:,6),'color',[%f %f %f],'lineStyle','%s','Marker','.');
axis ij

line([x_min x_max],[y_min y_min]);
line([x_min x_max],[y_max y_max]);
line([x_min x_min],[y_min y_max]);
line([x_max x_max],[y_min y_max]);


\%creation of arrays of interest
speed = diff(pos);
SqrtSpeed = [sqrt(speed(:,1).^2+speed(:,2).^2), sqrt(speed(:,3).^2+speed(:,4).^2), sqrt(speed(:,5).^2+speed(:,6).^2)];


\%detect first ball
[FirstBall,FirstRow] = find(abs(pos-pos(1,:))'>2,1);
FirstBall = ceil(FirstBall/2);


\%detect band touch
TouchBandLeft = ([0;diff(sign(speed(:,2*FirstBall-1)));0] > 0) & (abs(pos(:,2*FirstBall-1)-x_min) < (ball_diam*sqrt(abs([0;speed(:,2*FirstBall-1)]))));
TouchBandRight = ([0;diff(sign(speed(:,2*FirstBall-1)));0] < 0) & (abs(pos(:,2*FirstBall-1)-x_max) < (ball_diam*sqrt(abs([0;speed(:,2*FirstBall-1)]))));
TouchBandBottom = ([0;diff(sign(speed(:,2*FirstBall)));0] < 0) & (abs(pos(:,2*FirstBall)-y_max) < (ball_diam*sqrt(abs([0;speed(:,2*FirstBall)]))));
TouchBandTop = ([0;diff(sign(speed(:,2*FirstBall)));0] > 0) & (abs(pos(:,2*FirstBall)-y_min) < (ball_diam*sqrt(abs([0;speed(:,2*FirstBall)]))));


\%detect ball touch
BallTouch = [];
if FirstBall ~= 1 && find(sum(abs(pos(:,1:2)-pos(1,1:2))')'>4,1)
    temp = circshift(sum(abs(pos(:,1:2)-pos(1,1:2))')'>4,-3).*sqrt((pos(:,1)-pos(:,2*FirstBall-1)).^2+(pos(:,2)-pos(:,2*FirstBall)).^2).*(sqrt((pos(:,1)-pos(:,2*FirstBall-1)).^2+(pos(:,2)-pos(:,2*FirstBall)).^2)<(ball_diam*sqrt(1+abs([0;speed(:,2*FirstBall-1)]))));
    BallTouch(length(BallTouch)+1) = find(islocalmin(temp+1e20*(temp==0)),1);
end
if FirstBall ~= 2 && find(sum(abs(pos(:,3:4)-pos(1,3:4))')'>4,1)
    temp = circshift(sum(abs(pos(:,3:4)-pos(1,3:4))')'>4,-3).*sqrt((pos(:,3)-pos(:,2*FirstBall-1)).^2+(pos(:,4)-pos(:,2*FirstBall)).^2).*(sqrt((pos(:,3)-pos(:,2*FirstBall-1)).^2+(pos(:,4)-pos(:,2*FirstBall)).^2)<(ball_diam*sqrt(1+abs([0;speed(:,2*FirstBall-1)]))));
    BallTouch(length(BallTouch)+1) = find(islocalmin(temp+1e20*(temp==0)),1);
end
if FirstBall ~= 3 && find(sum(abs(pos(:,5:6)-pos(1,5:6))')'>4,1)
    temp = circshift(sum(abs(pos(:,5:6)-pos(1,5:6))')'>4,-3).*sqrt((pos(:,5)-pos(:,2*FirstBall-1)).^2+(pos(:,6)-pos(:,2*FirstBall)).^2).*(sqrt((pos(:,5)-pos(:,2*FirstBall-1)).^2+(pos(:,6)-pos(:,2*FirstBall)).^2)<(ball_diam*sqrt(1+abs([0;speed(:,2*FirstBall-1)]))));
    BallTouch(length(BallTouch)+1) = find(islocalmin(temp+1e20*(temp==0)),1);
end


\%clean up
TouchBandLeft(1:min(BallTouch)) = 0*TouchBandLeft(1:min(BallTouch));
TouchBandRight(1:min(BallTouch)) = 0*TouchBandRight(1:min(BallTouch));
TouchBandBottom(1:min(BallTouch)) = 0*TouchBandBottom(1:min(BallTouch));
TouchBandTop(1:min(BallTouch)) = 0*TouchBandTop(1:min(BallTouch));
if length(BallTouch) > 1
    TouchBandLeft(max(BallTouch):end) = 0*TouchBandLeft(max(BallTouch):end);
    TouchBandRight(max(BallTouch):end) = 0*TouchBandRight(max(BallTouch):end);
    TouchBandBottom(max(BallTouch):end) = 0*TouchBandBottom(max(BallTouch):end);
    TouchBandTop(max(BallTouch):end) = 0*TouchBandTop(max(BallTouch):end);
end


\%plot collisions
BandCollColor = [%f %f %f];
plot(pos(TouchBandLeft, FirstBall*2-1), pos(TouchBandLeft, FirstBall*2), 'color',BandCollColor,'Marker','o','linestyle','none')
plot(pos(TouchBandRight, FirstBall*2-1), pos(TouchBandRight, FirstBall*2), 'color',BandCollColor,'Marker','o','linestyle','none')
plot(pos(TouchBandBottom, FirstBall*2-1), pos(TouchBandBottom, FirstBall*2), 'color',BandCollColor,'Marker','o','linestyle','none')
plot(pos(TouchBandTop, FirstBall*2-1), pos(TouchBandTop, FirstBall*2), 'color',BandCollColor,'Marker','o','linestyle','none')
plot(pos(BallTouch, FirstBall*2-1), pos(BallTouch, FirstBall*2), 'color',[%f %f %f],'Marker','*','linestyle','none')


\%get messages
dist(1) = floor(sum(sqrt(speed(:,1).^2+speed(:,2).^2)));
dist(2) = floor(sum(sqrt(speed(:,3).^2+speed(:,4).^2)));
dist(3) = floor(sum(sqrt(speed(:,5).^2+speed(:,6).^2)));

if length(BallTouch) > 1
    TouchBallsMess = "2 balls touched";
elseif length(BallTouch) > 0
    TouchBallsMess = "1 ball touched";
else
    TouchBallsMess = "No ball touched";
end

TouchBands = sum([sum(TouchBandLeft) sum(TouchBandRight) sum(TouchBandBottom) sum(TouchBandTop)]);
if sum(TouchBands) >= 2
    TouchBandsMess = sprintf("\%d bands touched",sum(TouchBands));
elseif sum(TouchBands) == 1
    TouchBandsMess = "1 band touched";
else
    TouchBandsMess = "No band touched";
end

WinMess = "You lost.";
if length(BallTouch) > 1 && TouchBands > 2
    WinMess = "You won."; 
end

if FirstBall == 1
    Player = "Red";
elseif FirstBall == 2
    Player = "Yellow";
elseif FirstBall == 3
    Player = "White";
end


\%build title and text
time_t = floor(clock);
scoresheet_title = sprintf('Score Sheet %s - \%s - \%dh \%dmin \%ds',date,time_t(4:6));
sgtitle(scoresheet_title)

text_to_display = {sprintf("Scores for player \%s",Player),TouchBallsMess,TouchBandsMess,sprintf("dist(r) = \%dpx",dist(1)),sprintf("dist(y) = \%dpx",dist(2)),sprintf("dist(w) = \%dpx",dist(3)),WinMess};
x_text = x_min + [1 13 13 1 7 13 1]*(x_max-x_min)/18;
y_text = y_max + [14 14 43 72 72 72 43];
text(x_text,y_text,text_to_display);


\%create and save scoresheet
axis([x_min x_max y_min-5 y_max+100]);
set(gca,'visible','off');
set(gca,'xtick',[]);
set(gcf, 'PaperUnits', 'centimeters', 'Units', 'centimeters');
set(gcf, 'PaperSize', [29.7 21]);
set(gcf, 'Position', [0.5 0.5 28.7 20]);

saveas(ScoreSheet,'ScoreSheet','pdf');
open('ScoreSheet.pdf');